* { box-sizing: border-box; }
body { margin:0; font-family: system-ui, sans-serif; background:#0e1116; color:#e6e8ec; }
:root {
  --bg-elev-1:#161b22;
  --bg-elev-2:#1f242c;
  --bg-elev-3:#262d37;
  --border:#2e3742;
  --accent:#5d8bff;
  --accent-glow:#5d8bff33;
  --danger:#ff4d61;
  --warn:#ffb347;
  --ok:#46c677;
  --radius:8px;
  --focus-ring:0 0 0 2px #5d8bff,0 0 0 4px #5d8bff55;
}
button { font: inherit; }
::-webkit-scrollbar { width:10px; height:10px; }
::-webkit-scrollbar-track { background: var(--bg-elev-1); }
::-webkit-scrollbar-thumb { background: var(--bg-elev-3); border-radius: 8px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent); }

.app-shell { display:flex; flex-direction:column; height:100vh; }
.toolbar { display:flex; gap:.5rem; padding:.75rem 1rem; background:var(--bg-elev-2); border-bottom:1px solid var(--border); align-items:center; }
.toolbar h1 { font-size:1rem; font-weight:600; margin:0 1rem 0 0; }
.toolbar input.name { background:var(--bg-elev-3); color:inherit; border:1px solid var(--border); padding:.4rem .6rem; border-radius:var(--radius); min-width:240px; }
.toolbar button, .panel button { background:var(--bg-elev-3); border:1px solid var(--border); color:inherit; padding:.45rem .75rem; border-radius:var(--radius); cursor:pointer; display:inline-flex; gap:.4rem; align-items:center; }
.toolbar button:hover, .panel button:hover { background:var(--bg-elev-3); border-color:var(--accent); }
.toolbar button.primary { background:var(--accent); border-color:var(--accent); color:#fff; }
.toolbar button.primary:hover { filter:brightness(1.1); }
.main { flex:1; display:flex; overflow:hidden; }
.sidebar { width:260px; border-right:1px solid rgba(255,255,255,0.12); background:rgba(30,36,46,0.42); backdrop-filter:blur(18px) saturate(170%); -webkit-backdrop-filter:blur(18px) saturate(170%); display:flex; flex-direction:column; position:relative; box-shadow:0 8px 24px -10px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.04) inset; transition:width .28s ease, background .3s ease, backdrop-filter .3s ease; }
.sidebar::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0)); pointer-events:none; }
.sidebar.collapsed { width:56px; }
.sidebar.collapsed .sidebar-header span { display:none; }
.sidebar-header { padding:.75rem .75rem; font-weight:600; border-bottom:1px solid rgba(255,255,255,0.08); display:flex; align-items:center; gap:.5rem; }
.sidebar .collapse-btn { margin-left:auto; width:1.9rem; height:1.9rem; padding:.35rem; backdrop-filter: none; }
.sidebar.collapsed .collapse-btn span { transform:translateX(0); }
.project-list { flex:1; overflow:auto; }
.project-item { position:relative; padding:.5rem .9rem; cursor:pointer; display:flex; flex-direction:column; gap:2px; border-radius:6px; transition:background .18s ease; }
.project-item:hover { background:rgba(255,255,255,0.05); }
.project-item.active { background:rgba(255,255,255,0.09); }
.project-item small { opacity:.6; font-size:.65rem; text-transform:uppercase; letter-spacing:.05em; }
.project-item .proj-del { position:absolute; top:4px; right:6px; opacity:0; width:1.9rem; height:1.9rem; padding:.35rem; }
.project-item:hover .proj-del { opacity:1; }
.content { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.scroller { flex:1; overflow:auto; padding:1rem; display:flex; flex-direction:column; gap:1rem; }
.group { background:var(--bg-elev-2); border:1px solid var(--border); border-radius:var(--radius); padding:.75rem; display:flex; flex-direction:column; gap:.75rem; }
.group h2 { margin:0; font-size:.85rem; letter-spacing:.05em; font-weight:600; text-transform:uppercase; opacity:.8; }
.boxes-grid { display:flex; flex-direction:column; gap:.75rem; }
.prompt-box { position:relative; background:var(--bg-elev-3); border:1px solid var(--border); border-radius:var(--radius); padding:.5rem .5rem .75rem; display:flex; flex-direction:column; gap:.5rem; }
.prompt-box.dragging { outline:2px dashed var(--accent); }
.prompt-box-header { display:flex; align-items:center; gap:.5rem; }
.badge { font-size:.65rem; padding:.2rem .45rem; border-radius:999px; background:var(--accent-glow); color:var(--accent); text-transform:uppercase; letter-spacing:.05em; font-weight:600; }
.category-default { background:#5d8bff22; color:#5d8bff; }
.category-subject { background:#ffb34722; color:#ffb347; }
.category-style { background:#c678dd22; color:#c678dd; }
.category-background { background:#46c67722; color:#46c677; }
.category-composition { background:#ff6b6b22; color:#ff6b6b; }
.category-angle { background:#61dafb22; color:#61dafb; }
.category-reference { background:#a2b5ff22; color:#a2b5ff; }
.weight-ctrl { display:flex; gap:.25rem; align-items:center; font-size:.75rem; margin-left:auto; }
.weight-ctrl input { width:3rem; background:var(--bg-elev-2); border:1px solid var(--border); color:inherit; padding:.2rem .3rem; border-radius:4px; font-size:.7rem; }
.rte { background:var(--bg-elev-2); border:1px solid var(--border); min-height:70px; padding:.5rem; border-radius:6px; color:inherit; font:inherit; line-height:1.4; width:100%; resize:vertical; caret-color:var(--accent); }
.box-actions { display:flex; gap:.4rem; flex-wrap:wrap; }
.box-actions button { font-size:.65rem; padding:.3rem .55rem; }
.drag-handle { cursor:grab; opacity:.6; }
.drag-handle:active { cursor:grabbing; }
.image-ref { display:flex; gap:.75rem; }
.image-ref .thumb { width:90px; height:70px; border:1px solid var(--border); border-radius:4px; background:#111; object-fit:cover; display:flex; align-items:center; justify-content:center; font-size:.6rem; color:#666; overflow:hidden; }
.notice { font-size:.7rem; opacity:.7; }
.flex { display:flex; }
.flex.gap { gap:.5rem; }
.inline-input { background:var(--bg-elev-3); border:1px solid var(--border); color:inherit; padding:.25rem .5rem; border-radius:6px; }
footer.status { padding:.4rem .75rem; font-size:.65rem; opacity:.7; background:var(--bg-elev-2); border-top:1px solid var(--border); display:flex; gap:1rem; }
.toast-container { position:fixed; bottom:1rem; right:1rem; display:flex; flex-direction:column; gap:.5rem; z-index:1000; max-width:320px; }
.toast { background:var(--bg-elev-3); border:1px solid var(--border); padding:.75rem 1rem; border-radius:var(--radius); font-size:.8rem; animation:slideInRight .3s ease; box-shadow:0 4px 12px rgba(0,0,0,.3); position:relative; overflow:hidden; }
.toast::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg, var(--accent), var(--ok)); }
.toast:hover { transform:translateX(-4px); transition:transform .2s ease; }
@keyframes slideInRight { from { opacity:0; transform:translateX(100%) scale(.9);} to { opacity:1; transform:translateX(0) scale(1);} }
.preview-modal { position:fixed; inset:0; background:#000a; display:flex; align-items:center; justify-content:center; }
.preview-card { background:var(--bg-elev-2); max-width:760px; width:90%; max-height:80vh; overflow:auto; border:1px solid var(--border); border-radius:var(--radius); padding:1rem 1.25rem; display:flex; flex-direction:column; gap:1rem; }
.preview-card pre { white-space:pre-wrap; word-wrap:break-word; background:var(--bg-elev-3); padding:.75rem; border-radius:6px; font-size:.75rem; }
.search-bar { display:flex; gap:.5rem; align-items:center; }
.search-bar input { flex:1; }
.icon-btn { background:var(--bg-elev-3); border:1px solid var(--border); color:inherit; padding:.45rem; width:2.2rem; height:2.2rem; display:inline-flex; align-items:center; justify-content:center; border-radius:var(--radius); cursor:pointer; position:relative; }
.icon-btn:hover { border-color:var(--accent); background:var(--bg-elev-2); }
.icon-btn.danger { border-color: var(--danger); color: var(--danger); }
.icon-btn.danger:hover { background: #3a0f16; }
.icon-btn[data-tip]:hover:after { content:attr(data-tip); position:absolute; bottom:110%; left:50%; transform:translateX(-50%); background:#111c; backdrop-filter:blur(6px); padding:.35rem .55rem; white-space:nowrap; border:1px solid var(--border); border-radius:6px; font-size:.6rem; letter-spacing:.05em; text-transform:uppercase; pointer-events:none; opacity:1; }
.icon-btn[data-tip]:after { opacity:0; transition:opacity .15s ease; }
.toolbar .icon-btn { padding:.55rem; width:2.4rem; height:2.4rem; }
.box-actions { display:flex; gap:.3rem; flex-wrap:wrap; }
.box-actions .icon-btn { font-size:0; }
.tag-list { display:flex; gap:.35rem; flex-wrap:wrap; }
.tag-chip { background:var(--bg-elev-3); border:1px solid var(--border); padding:.15rem .45rem; border-radius:999px; font-size:.55rem; letter-spacing:.05em; display:inline-flex; align-items:center; gap:.3rem; cursor:default; position:relative; }
.tag-chip[data-color] { border-color:currentColor; }
.tag-chip button { all:unset; cursor:pointer; font-size:.8em; line-height:1; padding:0 .1rem; }
.tag-add { display:flex; align-items:center; gap:.4rem; }
.tag-add input { background:var(--bg-elev-3); border:1px dashed var(--border); color:inherit; padding:.25rem .45rem; border-radius:6px; width:120px; font-size:.6rem; }
.tag-add input:focus { outline:none; border-color:var(--accent); }
.tag-filter-btn { background:var(--bg-elev-2); border:1px solid var(--border); color:inherit; padding:.25rem .55rem; border-radius:999px; font-size:.55rem; cursor:pointer; letter-spacing:.05em; text-transform:uppercase; }
.tag-filter-btn:hover { border-color:var(--accent); }
.tag-filter-btn.active { background:var(--bg-elev-3); }
.meta-drawer { position:fixed; top:0; right:0; height:100%; width:300px; background:var(--bg-elev-2); border-left:1px solid var(--border); display:flex; flex-direction:column; padding:.85rem .95rem; gap:.75rem; z-index:1200; box-shadow:-4px 0 12px rgba(0,0,0,.4); }
.meta-drawer h3 { margin:0; font-size:.8rem; letter-spacing:.06em; text-transform:uppercase; opacity:.75; }
.metric-list { display:flex; flex-direction:column; gap:.4rem; font-size:.65rem; }
.metric-list div { display:flex; justify-content:space-between; }
.tag-freq { display:flex; flex-wrap:wrap; gap:.3rem; }
.tag-freq span { font-size:.55rem; padding:.15rem .45rem; background:var(--bg-elev-3); border:1px solid var(--border); border-radius:999px; letter-spacing:.05em; }
.meta-close { position:absolute; top:.4rem; right:.4rem; }
/* weight intensity border (0-5) */
.prompt-box[data-weight] { position:relative; --w: var(--w, 0); }
.prompt-box[data-weight]::before { /* gradient fill proportional to weight */
  content:''; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:linear-gradient(90deg, var(--accent-glow), transparent 70%);
  opacity:calc(var(--w) * 0.55);
}
.prompt-box[data-weight]::after { /* left intensity bar */
  content:''; position:absolute; left:0; top:0; bottom:0; width:4px; border-top-left-radius:inherit; border-bottom-left-radius:inherit;
  background:linear-gradient(to bottom, var(--accent), var(--accent));
  opacity:calc(.25 + var(--w) * .75);
}
.weight-legend { display:flex; flex-direction:column; gap:4px; margin-top:.25rem; }
.weight-legend .label-row { display:flex; justify-content:space-between; font-size:.5rem; letter-spacing:.05em; opacity:.7; }
.weight-legend .bar { position:relative; height:6px; border-radius:4px; background:linear-gradient(90deg, #444 0%, var(--accent) 100%); overflow:hidden; }
.weight-legend .bar::after { content:''; position:absolute; inset:0; background:repeating-linear-gradient(90deg, #fff2 0 2px, transparent 2px 14px); mix-blend-mode:overlay; opacity:.3; }
.prompt-box.invalid { border-color:#ff6b6b; box-shadow:0 0 0 1px #ff6b6b44, 0 0 0 4px #ff6b6b22; }
.prompt-box[aria-invalid='true'] .rte { border-color:#ff6b6b; }
.rte:focus { outline:none; box-shadow:0 0 0 1px var(--accent), 0 0 0 4px var(--accent-glow); }
